$(function(){T.AgainBadgeSub(),$("#ddProductStatusType").bindSelectPro(!0,enumClass.EnumProductStatusType,function(a){return!0});var a=window.location.href;$.ajax({url:G.DOMAIN.PLANNERAPI+"api/Product/GetProductCategoryList",type:"GET",async:!1,xhrFields:{withCredentials:!0},data:{},success:function(t){if(0==t.errno){var e="",i="";i+='<option value="">--请选择--</option>',i+='<option value="all">--全部分类--</option>';for(var o=0;o<t.data.length;o++){e+="<div class='layui-form-item'>",e+="<label class='layui-form-label' >"+t.data[o].CategoryName+"：</label >",e+=" <div class='layui-input-block'>",i+='<option value="'+t.data[o].CategoryID+'">>&nbsp;'+t.data[o].CategoryName+"</option>";for(var r=0;r<t.data[o].ChildList.length;r++){switch(t.data[o].ChildList[r].CategoryName){case"私募股权":e+="<a href='product_add_1.html?name="+t.data[o].ChildList[r].CategoryName+"&key="+t.data[o].ChildList[r].CategoryKey+"&url="+a+"&ProductType=1' class='layui-btn layui-btn-primary btn-bottom'>"+t.data[o].ChildList[r].CategoryName+"</a>";break;case"阳光私募":e+="<a href='product_add_1.html?name="+t.data[o].ChildList[r].CategoryName+"&key="+t.data[o].ChildList[r].CategoryKey+"&url="+a+"&ProductType=2' class='layui-btn layui-btn-primary btn-bottom'>"+t.data[o].ChildList[r].CategoryName+"</a>";break;case"信托":e+="<a href='product_add_1.html?name="+t.data[o].ChildList[r].CategoryName+"&key="+t.data[o].ChildList[r].CategoryKey+"&url="+a+"&ProductType=3' class='layui-btn layui-btn-primary btn-bottom'>"+t.data[o].ChildList[r].CategoryName+"</a>";break;case"资管":e+="<a href='product_add_1.html?name="+t.data[o].ChildList[r].CategoryName+"&key="+t.data[o].ChildList[r].CategoryKey+"&url="+a+"&ProductType=4' class='layui-btn layui-btn-primary btn-bottom'>"+t.data[o].ChildList[r].CategoryName+"</a>";break;case"私募债权":e+="<a href='product_add_1.html?name="+t.data[o].ChildList[r].CategoryName+"&key="+t.data[o].ChildList[r].CategoryKey+"&url="+a+"&ProductType=5' class='layui-btn layui-btn-primary btn-bottom'>"+t.data[o].ChildList[r].CategoryName+"</a>";break;case"公募基金":e+="<a href='product_add_1.html?name="+t.data[o].ChildList[r].CategoryName+"&key="+t.data[o].ChildList[r].CategoryKey+"&url="+a+"&ProductType=6' class='layui-btn layui-btn-primary btn-bottom'>"+t.data[o].ChildList[r].CategoryName+"</a>";break;case"寿险":case"医疗险":case"理财险":case"财产险":e+="<a href='product_add_2.html?name="+t.data[o].ChildList[r].CategoryName+"&key="+t.data[o].ChildList[r].CategoryKey+"&url="+a+"&ProductType=7' class='layui-btn layui-btn-primary btn-bottom'>"+t.data[o].ChildList[r].CategoryName+"</a>";break;case"银行理财":e+="<a href='product_add_3.html?name="+t.data[o].ChildList[r].CategoryName+"&key="+t.data[o].ChildList[r].CategoryKey+"&url="+a+"&ProductType=9' class='layui-btn layui-btn-primary btn-bottom'>"+t.data[o].ChildList[r].CategoryName+"</a>"}i+='<option value="'+t.data[o].ChildList[r].CategoryID+'">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'+t.data[o].ChildList[r].CategoryName+"</option>"}e+="</div>",e+="</div>"}$("#add_product_div").empty(),$("#add_product_div").html(e),$("#ddcategoryID").empty(),$("#ddcategoryID").html(i)}else parent.location.href=G.DOMAIN.PLANNER+"login.html"},error:function(a){alert("提交错误")}})}),layui.use(["element","form","layedit","laydate","laypage","laytpl","upload","jquery"],function(){function a(e){r.ajax({url:G.DOMAIN.PLANNERAPI+"api/Product/GetProductList",type:"GET",xhrFields:{withCredentials:!0},data:{pageIndex:e||1,pageSize:15,statusFlag:5},success:function(i){var l=i.data.TotalPage;o({cont:r("#page"),pages:l,skin:"molv",curr:e||1,jump:function(e,o){o||a(e.curr);var l=TrimPath.processDOMTemplate("product_list",i);r("#list").empty(),r("#list").append(l),r("#PageSum").html(i.data.TotalRecord),t.render()}})},error:function(a){layer.alert("提交错误",{icon:5})}})}layui.element();var t=layui.form(),e=(layui.layedit,layui.laydate),o=layui.laypage,r=(layui.laytpl,layui.jquery);a();var l={min:"1900-01-01 23:59:59",max:"2099-06-16 23:59:59",istoday:!1,choose:function(a){d.min=a,d.start=a}},d={min:e.now(),max:"2099-06-16 23:59:59",istoday:!1,choose:function(a){l.max=a}};document.getElementById("start_date").onclick=function(){l.elem=this,e(l)},document.getElementById("end_date").onclick=function(){d.elem=this,e(d)},t.on("submit(search)",function(a){function e(a){r.ajax({url:G.DOMAIN.PLANNERAPI+"api/Product/GetProductList",type:"GET",xhrFields:{withCredentials:!0},data:{pageIndex:a||1,pageSize:15,statusFlag:5,categoryID:l,productName:d,productStatusType:n,publishTimeBeg:c,publishTimeEnd:s},success:function(i){r("#page").empty();var l=i.data.TotalPage;o({cont:r("#page"),pages:l,skin:"molv",curr:a||1,jump:function(a,o){o||e(a.curr);var l=TrimPath.processDOMTemplate("product_list",i);r("#list").empty(),layer.close(loading),r("#list").append(l),r("#PageSum").html(i.data.TotalRecord),t.render()}})},error:function(a){layer.alert("提交错误",{icon:5})}})}loading=layer.load(2,{shade:[.2,"#000"]});var i=a.field,l=i.categoryID,d=i.productName,n=i.productStatusType,c=i.publishTimeBeg,s=i.publishTimeEnd;return e(),!1}),t.on("checkbox(checkAll)",function(a){r(a.elem).parents("table").find('tbody input[type="checkbox"]').each(function(t,e){e.checked=a.elem.checked}),t.render("checkbox")}),t.on("submit(submits)",function(a){var t=!1;return r("input[lay-filter='checkOne']").each(function(){r(this).prop("checked")&&(t=!0)}),t?(layer.confirm("确定提交?",{title:"提示"},function(t){loading=layer.load(2,{shade:[.2,"#000"]});var e=a.field,o=[];for(i in e)"on"==e[i]||o.push(e[i]);var l=o.join(",");r.ajax({url:G.DOMAIN.PLANNERAPI+"api/Product/SubmitProduct",type:"GET",xhrFields:{withCredentials:!0},data:{productIDs:l},success:function(a){0==a.errno?(layer.close(loading),layer.msg("提交成功",{icon:1,time:1e3},function(){location.reload()})):(layer.close(loading),layer.msg("提交错误",{icon:2,anim:6,time:1e3}))},error:function(a){layer.close(loading),layer.msg("提交错误",{icon:2,anim:6,time:1e3})}})}),!1):(layer.msg("请选择需要提交的产品",{icon:2,anim:6,time:1e3}),!1)}),r("#table").on("click",".odd_cancel",function(){var a=r(this).attr("data-id");layer.confirm("确定提交?",{title:"提示"},function(t){loading=layer.load(2,{shade:[.2,"#000"]}),r.ajax({url:G.DOMAIN.PLANNERAPI+"api/Product/SubmitProduct",type:"GET",xhrFields:{withCredentials:!0},data:{productIDs:a},success:function(a){0==a.errno?(layer.close(loading),layer.msg("提交成功",{icon:1,time:1e3},function(){location.reload()})):(layer.close(loading),layer.msg("提交错误",{icon:2,anim:6,time:1e3}))},error:function(a){layer.close(loading),layer.msg("提交错误",{icon:2,anim:6,time:1e3})}})})}),r("#add_product").click(function(){var a=r("#add_product_div").html();layer.open({area:["500px","auto"],title:"请选择产品分类：",content:a,btn:["取消"],yes:function(a,t){layer.close(a)}})}),r("body").on("click",".LookCause",function(){var a=r(this).siblings(".LookCausePop").val();layer.alert(a,{title:"未通过原因",icon:5})}),t.render()});